import React, { useContext } from 'react';
import { ThemeContext } from '../../theme-provider';

type RankBadgeProps = {
  rank: number;
};

const getBadgeClass = (rank: number, theme: string) => {
  const baseClass = 'flex pl-2 right-0 pr-1 gap-1.5 font-bold items-center min-w-[50px] h-[22px] my-[5px] rounded-full';

  const textColor = theme === 'light'
    ? 'text-black'
    : (rank > 1000 ? 'text-white' : 'text-black');

  const rankClasses: { [key: string]: string } = {
    '1': 'bg-yellow-500 font-extrabold',
    '2': 'bg-gray-300',
    '3': 'bg-orange-600 font-extrabold',
    'default': rank >= 4 && rank <= 1000 ? 'bg-red-600/90' : 'pr-7',
  };

  return `${baseClass} ${textColor} ${rankClasses[rank.toString()] || rankClasses['default']}`;
};

export const RankBadge: React.FC<RankBadgeProps> = React.memo(({ rank }) => {
  const { theme } = useContext(ThemeContext);
  const badgeClass = getBadgeClass(rank, theme);

  return (
    <div className={badgeClass} data-testid="rankBadge">
      {`#${rank}`}
      {rank <= 1000 && (
       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500" width="20" height="20"><path d="M227 11.1c-82.7 8.5-154 58-190.6 132.4-8.8 17.9-12.4 27.6-16.9 45.1-6.2 24-7 31-7 60.9.1 21.1.4 29.2 1.8 37 7 40.2 22.2 75.6 45.7 107 9 12.1 32.5 35.9 43.5 44.2 38 28.6 79.3 45.1 124 49.4 16.3 1.6 45.6.6 61-2 24.6-4.2 44.5-10.6 67-21.6C418 433 464.2 376.4 481.6 309c8.5-33.1 9.7-71.5 3.3-104.9-13.6-70.6-58.1-131.2-121.3-165.6-26.4-14.3-60-24.4-91-27.4-12.6-1.3-33.3-1.2-45.6 0m-66.9 83.3-.2 13.4 5.8 3.3c3.2 1.8 8.4 5 11.6 7.2l5.8 3.9-7.2 4.4c-7.6 4.7-12.6 8.4-19.8 14.6-2.8 2.5-5 3.6-6 3.3-.9-.4-6.7-2.1-13-4l-11.4-3.2-1.8-5.9c-1-3.3-2.6-9.4-3.5-13.8l-1.7-7.8 3.9-3.4c11.4-10 36-26.9 37.3-25.8.2.2.3 6.4.2 13.8m196.5-4.3c7.7 5.2 20.9 15.5 23.6 18.6 1.7 1.8 1.6 2.3-.3 10.3-4.3 18.1-4.6 18.7-8.7 19.5-2 .4-7.9 2-12.9 3.6l-9.3 3-6.7-5.8c-3.7-3.1-10.8-8.3-15.6-11.4l-8.8-5.7 4.3-2.9c2.4-1.7 7.6-4.9 11.7-7.3l7.4-4.4-.6-13.9-.6-13.8 4.7 2.7c2.6 1.5 7.9 4.9 11.8 7.5m-253.2 48c4.8 12.6 7.6 17.9 9.9 18.3 1.2.3 6.3 1 11.2 1.6 14.9 1.9 14.2.9 7.9 10.2-3 4.4-7.5 12-9.9 16.9L118 194h-4.8c-2.6 0-8.5.7-13.2 1.5l-8.5 1.5-2.8-3.2c-1.6-1.8-5.5-6.8-8.7-11.2l-5.9-7.8 5.6-11.2c7.2-14.4 19.6-33.6 20.9-32.3.2.2 1.4 3.2 2.8 6.8m306.3 5.4c2.6 3.8 7.5 12.4 11 19l6.2 12.1-5.7 7.6c-3.1 4.1-7.1 9.2-8.9 11.2l-3.2 3.6-9.8-1.5c-5.4-.8-11.4-1.6-13.3-1.7-3.1-.3-3.7-.8-5.8-5.3-3.3-6.9-9.9-18.1-13.9-23.5-4-5.3-4.1-5.3 8.8-7 15.8-2.1 14.4-1.4 17.2-7.8 2.2-5 4.7-11 7.1-17.7.7-1.9.9-1.8 3.2 1 1.4 1.6 4.6 6.1 7.1 10M313 239.9c0 42.7-.4 68.2-1 68.6-.8.5-37.2-13.6-153.3-59.2-10-4-16.7-7.2-16.7-8 0-1.1 11-1.3 63-1.3h63l3.7-6.1c2.1-3.3 10-15.8 17.6-27.7s15.6-24.5 17.8-28c2.2-3.4 4.4-6.2 4.9-6.2.7 0 1 24 1 67.9M82.5 217.3l3.1 2.7 11.9-3.5c14.7-4.4 14.6-4.4 13.4-.3-1.4 4.9-3.9 24.2-3.9 30.1v5.2l-5.3 2.9c-2.8 1.6-8 4.7-11.5 6.9l-6.4 4-5.6-2.7c-3.1-1.6-8.8-4.6-12.6-6.8l-6.9-4.1.7-11.2c.7-11 2.4-23.8 4.7-34.5l1.1-5.2 7.2 6.9c3.9 3.7 8.5 8.1 10.1 9.6m355.4-5.3c1.1 5.8 2.3 14.8 2.6 20s.8 11.8 1 14.6l.5 5.2-6.8 4c-3.7 2.2-9.4 5.2-12.5 6.6l-5.8 2.5-11.3-6.7-11.3-6.7-.8-10.1c-.4-5.6-1.5-14.3-2.4-19.3-1.6-8.2-1.6-9.1-.2-9.1.9.1 6.8 1.6 13.1 3.4l11.5 3.4 7.5-6.8c4.1-3.7 8.6-8 9.9-9.4 1.4-1.4 2.6-2.5 2.7-2.3.1.1 1.1 4.9 2.3 10.7m-326 72.3c1.2 4.9 3.5 12.4 5.2 16.7l3.1 7.9-6 8c-3.3 4.4-6.8 9.4-7.8 11-1.3 2.2-2.6 3.1-4.4 3.1-5.5 0-24.5-2.1-25.2-2.8-2.6-2.6-12.4-33.3-14.3-44.9l-.6-4.1 10.1 4c15.1 5.9 16.3 5.9 21.3 1 2.3-2.3 6.7-5.9 9.7-8.1 6.4-4.5 5.7-5.1 8.9 8.2m294.6-1.1c6.6 5.9 7.2 5.9 22.8-.2 5.3-2.1 9.7-3.7 9.7-3.6 0 0-.7 3.5-1.4 7.6-2.1 10.4-6.1 23.8-10 33.4l-3.4 8.1-4.4.6c-2.5.4-8.8 1-14 1.4l-9.5.7-3.3-5.3c-1.8-3-5.3-8-7.8-11.2l-4.4-5.9 2.5-6.6c3.3-8.7 6.3-18.6 7.2-24.2.4-2.5.9-4.8 1.2-5.3.5-.9 7.4 3.9 14.8 10.5m-270.9 51.5c3.2 4.3 8.8 11 12.5 14.8l6.8 7.1-1.8 7.4c-1 4.1-2.1 10-2.5 13.1l-.7 5.7-7.3 2.6c-4 1.5-10 3.5-13.4 4.5l-6 1.9-7.4-7.2c-8.4-8.1-16-17.1-21.8-25.6l-4-5.8 8.8-.7c4.8-.4 10.9-1 13.6-1.3l4.9-.7 5.9-11.8c3.3-6.4 6.1-11.7 6.3-11.7s3 3.5 6.1 7.7m242 4.2 5.9 11.9 6 .6c3.3.3 9.4.8 13.6 1.2l7.7.6-5.4 7.7c-6 8.5-17.6 21.7-24 27.4l-4.1 3.6-6.1-1.8c-3.4-1.1-9.3-3.1-13.1-4.6l-7-2.8-1.1-7.1c-.6-3.9-1.9-9.7-2.7-12.8l-1.6-5.8 7.9-8.3c4.4-4.6 10-11.3 12.4-15 2.5-3.6 4.8-6.7 5.1-6.7s3.2 5.4 6.5 11.9m-166.2 64.8c20.8 8 38.5 14.6 39.1 14.6s18.3-6.6 39.4-14.8c21-8.1 38.3-14.6 38.5-14.4.7.7 5.6 13.2 5.3 13.5-.1.1-13.2 5.2-29.2 11.4-15.9 6.2-29.9 11.6-31 12-2.3.9-2.2 1 14.7 7.4l9.7 3.8-2.6 6.6c-1.3 3.7-2.6 6.8-2.8 7-.1.2-9.7-3.3-21.2-7.8l-20.9-8.1-20.7 8.1c-11.4 4.4-20.9 8-21.1 8-.3 0-1.3-2.4-2.4-5.3-1.1-2.8-2.3-5.9-2.7-6.8-.5-1.4 1.4-2.5 10.2-5.9 5.9-2.3 11.9-4.6 13.3-5.2 2.2-.8-1.4-2.5-28.5-13-17-6.6-31.1-12.1-31.3-12.2-.2-.3 1.3-4.9 3.7-10.9.6-1.5 1.4-2.7 1.8-2.7s17.8 6.6 38.7 14.7"/></svg>
      )}
    </div>
  );
});
